# Nombre del workflow en GitHub Actions
name: Trigger CodePipeline

# üîπ Evento que dispara el workflow:
#    - Se ejecuta autom√°ticamente en cada push a las ramas dev, test o main
on:
  push:
    branches:
      - dev      # Despliegue al ambiente de desarrollo
      - test     # Despliegue al ambiente de pruebas
      - main     # Despliegue al ambiente productivo

jobs:
  trigger:
    runs-on: ubuntu-latest   # üîπ Runner en Linux que ejecutar√° los pasos

    steps:
      # 1Ô∏è‚É£ Configuraci√≥n de credenciales AWS
      #    Usa secrets almacenados en GitHub (repositorio o organizaci√≥n)
      - name: Configurar credenciales AWS
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1   # Cambia si usas otra regi√≥n

      # 2Ô∏è‚É£ Disparo condicional de CodePipeline seg√∫n la rama
      - name: Disparar CodePipeline (seg√∫n branch)
        run: |
          if [[ "${GITHUB_REF##*/}" == "dev" ]]; then
            aws codepipeline start-pipeline-execution --name DeploymentPipelineDev
          elif [[ "${GITHUB_REF##*/}" == "test" ]]; then
            aws codepipeline start-pipeline-execution --name DeploymentPipelineTest
          elif [[ "${GITHUB_REF##*/}" == "main" ]]; then
            aws codepipeline start-pipeline-execution --name DeploymentPipelineProd
          fi